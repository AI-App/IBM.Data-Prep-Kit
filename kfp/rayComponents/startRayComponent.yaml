name: Start Ray Cluster
description: Starts Ray cluster

inputs:
    - { name: ray_name, type: String, description: "Ray cluster user name" }
    - { name: run_id, type: String, description: "The KFP Run ID" }
    - { name: num_workers, type: Integer, description: "number of workers" }
    - { name: cpus, type: Integer, description: "cpus per worker" }
    - { name: memory, type: Integer, description: "Memory per worker" }
    - { name: num_gpus, type: Integer, description: "Number of gpus per worker" }
    - { name: image, type: String, default: "", description: "image for Ray cluster" }
    - { name: server_url, type: String, default: "", description: "url of api server" }
    - { name: additional_params, type: String, default: "{}", description: "additional parameters" }


implementation:
    container:
        image: us.icr.io/cil15-shared-registry/preprocessing-pipelines/kfp-guf:0.0.1-test
        # command is a list of strings (command-line arguments).
        # The YAML language has two syntaxes for lists and you can use either of them.
        # Here we use the "flow syntax" - comma-separated strings inside square brackets.
        command: [
                python,
                # Force the stdout and stderr streams to be unbuffered
                -u,
                # Path of the program inside the container
                /pipelines/component/src/start_ray_cluster.py,
                --ray_name,
                { inputValue: ray_name },
                --run_id,
                { inputValue: run_id },
                --num_workers,
                { inputValue: num_workers },
                --cpus,
                { inputValue: cpus },
                --memory,
                { inputValue: memory },
                --num_gpus,
                { inputValue: num_gpus },
                --image,
                { inputValue: image },
                --server_url,
                { inputValue: server_url },
                --additional_params,
                { inputValue: additional_params },
            ]
